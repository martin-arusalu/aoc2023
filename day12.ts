const real = `?#?##?#????.?..?? 9,1
????????#???#? 1,8
.??????#???#??????? 2,7,1,1
???.?.?.???#.? 1,1,1,4
??#???#?##??. 4,5
??????##??#???????? 1,10,1
?#?#??.???.???? 6,1,2
?#?#??..#???#???#? 6,1,4,2
??????.?.???#?####? 5,1,9
.#?#??#.????#?#??#? 4,1,1,5,1
????..????..??? 3,2,2
.?#??#.??.? 4,2
???#????#??? 2,4
#.??#??#??.????#? 1,3,3,1,1
???.#?????#. 1,1,4,2
??#?#?.??#??. 3,1,1,3
?????#???? 2,4,1
?.??????.?#?#? 5,3
.?????#???..? 7,1
.????????.# 1,3,1
???#.?.?.. 1,1,1
?.???.??????#??#??? 2,2,6
??#???.???????#??# 2,10
?#??#?.????.???? 2,2,1,1,1
????#?##??. 1,6
#?#???#???.????? 8,1
???.?????#???? 1,7
?????#?????#?...???# 11,1,1
?.?#?.??.#?#? 2,2,4
???#.????#??##. 1,1,3,1,2
??????.????? 2,1
???#???#?..??.?#??## 1,7,2,6
?.??#..#???#???.?? 1,1,5,1,1
?.???###?? 1,5,1
???.?.#??#?????.?#? 3,2,1,3,1
???.??.???? 1,1,3
.?##????????.. 6,1
????????#???##?#?#. 1,2,2,8,1
?##?#?????#.????? 4,1,2,4
?????#??.?#? 4,3
?##???.#??.? 2,1,1,1
???.#???#??????# 5,4
?.?????#.???#..? 4,1,1,1,1
.?????#??????..#? 8,1,1
????#??##?? 4,2
.??##??#?????.. 1,9
?.?????????? 1,3,1
?#??..????..??? 1,2
??????.?.????? 2,2
?.??##?.?? 1,4,2
??#?.#?.#. 3,1,1
??.?##???????#.? 2,5,3
???.?#?.?#?#?. 1,1,1,4
??.#???????.# 1,1,3,1
??###???#? 4,2
?.?????#??#???? 1,1,1,5
?..??.?##?????? 1,1,2,1,1
#??#.#.?.???? 4,1,1,2
?#?????#???#??#.#?. 6,1,5,1
?.?###???.????#??? 1,4,1,1,1,4
???#?.#.##?#?##? 3,1,8
??#?#?#??????#??#?.? 1,6,7
##???#?#.???.? 8,1,1
?..#??.????#?#??.?? 3,5
?????#?##??. 2,4,1
??.???###?.?????.? 1,6,1,1,1
??????????#?#??? 2,4,1,1,2
?#???#???#???.?#? 2,9,2
?#??..????? 1,3
??#?.?.????#.? 3,1,2
???#??#?#..???? 2,3,4
?#.##?#?..???#?##.?# 1,2,2,4,2,2
???.?..#?.???? 1,1,2,3
????#?#????.? 1,8,1
?#?????????#?? 1,1,3,5
???.#??#????? 4,1,1
.#????.??? 1,1,1
??.?????#????#?#? 2,1,2,1,4
.???.????? 3,1,1
#????#??##???? 1,9
????#?#?#??.?#?? 4,1,1,2
??????..?#? 5,3
??#?#??#????#???#??. 7,5
??###?.???#??.#. 5,5,1
?????##??. 3,3,1
?.??????#????????# 1,1,12
.????.????? 1,1
???.??#??..?#?..?#?. 3,4,3,2
???????.?#??? 3,3,3
??#???.?????? 2,1
?#?.?##?#??## 1,6,2
.????.??#??#?.... 1,6
.???.#???#? 1,5
.?#.???#??? 2,2
#...??.???#? 1,1,1,1
#.???.?#.??????????# 1,1,1,1,11
????#??.?? 4,1
??#???..??? 5,1
..??????#?? 1,5
????##?#?.??????.? 6,4,1
?.?????????????..? 5,3
??#???????????##???? 5,2,2,6
.?#??.??#???# 3,4,2
????#?#????##? 5,3
?#?.??.???#???#?##? 1,1,12
??.???#.????????##?? 1,1,2,1,1,8
.??????#??? 2,3
?#?????#?#? 2,4
.?????..????? 2,3
.?.???#????.???..?. 4,2
??.??..????????. 2,2
??##????#???.?#? 1,10,2
??????#??.?...? 1,3
??##???#?.????#????? 6,6
?#?????#?#?????? 2,5,3
??#???????#???? 5,4,1
#?.????..?#?. 1,1,1,2
????????#??#####? 3,12
????????#??#? 2,1,6
????##??.?#. 2,3,2
.?.?##?.????#???. 1,2,8
?.#.????.#????? 1,4
??????????.? 1,1,2,1
??.????#??##?. 1,1,6
???.?#??..# 3,3,1
?????#??????.?#.. 10,2
...??.???????#???#?. 1,11
??????.#.??.?.? 3,1,1,1,1
????.#????#?.#?#?? 2,1,2,1,1,1
???#?#..#???? 4,1,2
.????..?#?#??.? 2,6
.??#??###?#?#??#??.. 4,12
??#???#??# 2,1,1
????..#???..???? 3,1,2,1,1
.#??.???#? 1,1,1
?#??#?.???#. 1,1,1,1
?....????##?.??..? 1,1,1,3,1,1
???.#???????#??.#?# 1,11,3
.?.?#????#? 2,1,1
?#??#??#.??#?.?????? 7,2,3
???????????.?. 1,1,5,1
??#???####?# 3,6
??#??#.?????????? 1,4,1,1,5
??####?##??.#.?. 8,1
?????#??.?#?#?? 3,2,4
?.???##?#...?? 7,1
?#?.#?##?#?????# 1,12
.?????#??#??#???.?#. 1,13,1
.??##??#?????# 1,6,2
??.??.?##????.? 1,1,6,1
??..????#?#. 1,2,3
?#?.?#..???? 3,1,1,1
?.##??????? 2,2
????#?###??.???# 3,6,1,2
?#??????#???.??????? 11,3
???..#?##??# 1,1,5,1
???#?..?????? 4,2,1
#?#????.??..?# 5,1,2
?#???.???? 2,2
???###?###??.#.? 11,1
????###?#?#???. 11,1
??#??????#??? 2,2
#??.#...??#? 3,1,1,1
.#.?.?##??#???#.?.#? 1,1,8,1,1,2
?#???????#..#?? 4,1,1,1
##??#?#.???.?.? 3,3,3,1
????.??..????????? 1,1,1,3,1,1
???????#????. 1,1,4
???????#????# 1,5,1
..#??????? 2,4
??#???.???? 2,4
.???#??.???##?. 5,4
?.???##.??????..? 2,3
.#???.?.??#???#??#?? 1,1,1,10
.??.#???#???? 2,9
???????##????????.? 1,10,1
?#.?.#??#?????. 1,1,1,3,1
???.????#.?.? 5,1
?.?#???#??????.? 1,1,2,3,1
??#??..?#.? 5,2
.??#?.#.#.?? 3,1,1,2
??#.?#?.???#?? 3,2,3
??????#???..?.??.?? 8,2
??..??.?#??? 2,1,3
??.???#???? 2,2,1
??????#???.#??# 1,2,2,4
#??.#?#?...??????## 1,1,4,1,1,2
???#????#????.?.???? 12,2
?#?##?.??????? 5,3,1,1
??????.??????? 1,2,4
???..??????..??## 2,3,1,1,2
?.??..????.?? 1,1,2,1
#?.???.?..??? 1,2,1,2
????#.#??#??????#?? 1,2,2,10
?????###??? 7,1
?#??#?..???.#?? 6,3,1,1
?#??.?.?##?#??? 3,1,5,1
??#??#???#???##? 1,2,1,2,5
?#?#.#?....??????. 2,1,2,1,1,1
.????##???..?#. 7,1,2
???..?.??#?#?.?#. 1,4,2
??.?.????.#.????#?? 1,1,2,1,7
?#?????#??.? 1,2,1,1
???#???#?????? 9,1
??..???.?##..?? 2,2,3,1
?.#??????????????? 8,1,2
??#??#?####??.???? 1,7,2
#.???..#.? 1,1,1
?????#..????? 4,1,1,1
??.???##?#???.# 1,5,1,2,1
????.??.?#?. 3,1
#??.???????????##?.? 1,1,13,1
?#.???###?.?.?? 1,1,5,1,2
??#??????#?????????? 11,2
???..????. 1,1,3
.?????????????? 1,4
?.#????.???#????? 5,5
???????.#??#?.. 1,1,1,2,2
?????.????????????? 1,2,2,8
.???????#?? 3,3
??.????#??..?.??#. 1,3,1,1,1,1
?.#??#???.?? 1,1,1,1
.??????????? 5,2
.???????#??? 8,1
.#?..#???#?.#. 1,1,2,1
.???#?#???.???? 7,2
??.?????????#????#.. 2,9
??##???????#????# 5,1,1,1,1
?#????#??.#??.??? 8,3,1
?.#??#?.#?. 1,2,1
#???????#???#? 2,6,3
??##?#?.?#?? 4,2,3
???.#????????.?? 1,1,8,1
##???.??????#???# 4,1,2,2,2
??###?.?#???? 4,4
#?#??.?#?.?.?#?##..# 1,1,3,5,1
.????#?????#?#??. 2,1,7
.???###??###????.?? 12,1
??.???####?.??? 1,5,2
??#????????.?##??## 1,1,1,1,6
???##????#????????## 1,5,1,5,3
.??#?#??#?####??.? 5,8,1
???#??##...#????? 8,3
.??...##????.? 1,5,1
.??#????????#? 7,3
.???.?##.??????.? 3,3,1,2
????#??##??#?. 3,5
??##??#???#.? 7,2,1
#.??#??#??#???.??? 1,2,7,1
...???.#.??? 2,1
#???.?##?###??# 1,2,2,6
????.?#??.? 2,1,1
???..?#?#??.#???? 1,6,3
?..?????#?? 1,1,2
.?##??.?.?#? 5,2
###???????#?? 3,2,2,1
????????#?##??.. 1,1,4,3
??.?.?#????#?..#.#?# 1,5,1,1,1,1
.#???#?.#???? 1,1,1,5
?????.?#?.?#?? 2,1,2,3
?#???????????#?###? 1,1,1,8
???#???#.#??? 1,3,1,1
??#?#????????? 3,2,5
?.???????#???# 2,6
??##???##??. 4,5
????#?.??#??#???#. 4,9
#??.???.?.??## 2,1,1,2
?#??.????#?.? 3,2,1
..#?##.?.##??##???? 4,7
.??.?##???#???#?.?? 8,1
#.?????#?????? 1,6,1,2
?#????.#?.??.#?? 5,1,1,1
?.?.#?#??????.? 1,1,4,1,1
??.?#????.??#..#?? 5,2,2
?#??#????. 2,4
?#????#??#?.#?? 1,1,5,1,1
#??##??#??#? 2,3,1,2
??.?.#???#?.??#?#. 2,2,2,3,1
.##????.?##.?? 3,3
#?.???.??#?#???.?#? 2,2,2,2,2
??.????#???????#?? 2,3,1,1,3,2
??#??#.#??#???#?.? 1,1,1,5,1,1
??.????###.?. 1,5
?#???###?.????? 1,5,2
????#?#???.? 7,1
.???#???### 3,1,3
??#..?#??. 3,4
?????##?.?? 1,4
?.??#.??????#?#??#? 1,2,1,5,1
????..??#?? 3,2
#.????.?#???##??# 1,1,10
??????????..?.???? 7,2,4
?#.????????? 2,3,1,2
.?????.#??#? 2,4
???#?????#.????.? 1,7,2,1,1
..???##?????#?? 8,2
?#????????? 5,1
????#?#????. 3,2,1
???..?..#?..# 3,1,2,1
.????.???????? 1,3,1,1
.????#?.???#??##?.?? 1,3,7,1
..??#?#???..#?#???? 3,1,1,4,1
.??.?????.?#?##??.? 2,1,6
???#.?#.??#?? 2,1,1,2
?.??????#?????????. 1,5,1,2,1
???##?##?.???#?. 1,6,2,2
.??#....??.? 2,1
.??????.?#???.??? 1,2,1
??.??...?##?##????? 2,9
.#??#?#?????????.??? 11,3,1,1
???#??#?#????.???? 12,1,1
???.????#??? 1,1,2,1
?#.??#???##????. 1,12
?.????????#?? 1,2
.??###??????????#?## 5,1,7
.#?##.???.?.?.???? 4,1,1,1,1,1
?#??###??##..?##? 1,7,3
???#.??.?###?#.? 4,1,3,1,1
???????##?##??#.. 3,1,8
??#?#.???#?#????? 4,1,4,1
?##??#??#?##?? 2,1,6
#?#?.?##?????. 1,1,8
????????.#? 6,2
.??#.?#?#??.?. 1,5
?.?#?.?.????? 2,1,2
?#????#??????.?????? 2,1,1,3,2,3
????????#?.##.?.?? 8,2
?#????#????????#.??? 5,3,2,1,1,2
#?#????#..???????#? 1,3,1,4,1,1
.#???#.???????.#???? 5,1,1,3,1,3
.??????.?#?##???? 5,6
?.??#.?????#####???? 1,1,9,1
#???#????#.??.?## 2,2,4,1,3
#????#????#.?#???#?. 1,1,1,4,5
?#????.??. 5,1
????##?????? 7,2
?#?#??#?#????.?.#?? 9,1,2
??##.?##?#??.??..?? 4,4,2
..??.??????? 2,7
?#??#.#?##????? 4,1,6
??.?#?.?#?.?????? 3,1,6
.#??????.?? 4,1,1
##??.##??.?##?#???? 4,4,6,1
??????#?????#?? 10,2
?##??????? 3,5
.??????????.#?#.? 9,1,1
..???#????##??#? 2,1,8
??????#??#???????# 1,1,1,8,1
?..???.???#?##?#. 2,6
?#????##.???#?# 2,3,6
?#????#??? 4,3
#?.??????????#???. 1,1,2,3,3
????????????..?.? 1,4
##?#??#.?#??.#??# 7,1,1,4
??.?????????#..???. 1,1,8,2
????#?????.?#? 2,1,3,2
.?#??..#??? 3,1,1
?#?#?????#????? 1,1,9
#???#?#?#?.? 1,7,1
#??????##??..?#?#??? 2,6,6
.??###??????#???. 3,3,3
?????????????##.?? 1,1,8,1
????????#.??#???# 9,2,1
???#????????? 1,6,2
.?????.???.??.. 5,1,2
?#?.??????.??# 1,6,1
???#???.????? 2,1,3
.#.????#..?##?.????? 1,1,2,3,2
?#?.?#???#?.?. 2,6
.##?#.#??#???????### 2,1,1,1,1,4
????#???.????.#.? 7,1,1,1
#???.????? 1,4
##??#???#??????????? 5,10,1
?#??????..??? 5,1
.???#??#?##? 1,7
??..#?#??????#. 2,4,3
?.??????#??.???.?.?? 3,5,1,1,1
??????#?.??. 5,1
#??.??#?.?#?##??#? 3,1,1,5,1
##?#?.?.#? 5,1
????#???.? 4,1,1
.??#?#????..?????? 1,1,3,1,1,1
??#????#?##???????? 1,1,11,2
#??.?#?#???.# 1,6,1
??.??????.? 3,2
???#?.?????#?##?#.# 4,1,7,1
????##???#?.??.# 2,5,1,2,1
?.?###????#?#??#???? 11,1,1
???#.????.?.?#?#??#. 4,3,1,5,1
?##?###?????.??? 9,1,2
??#???.????????#???? 4,1,8,1
#?#????.???.? 6,1
?????..??.????.??? 1,4
.??.???.??.?#??.?.? 1,2
.?.??#?.??#??#??#? 3,7
?#?????..????? 4,1,2,1
????????????#?? 4,5
??.?#???#??.??? 1,3,2,2
##??#?.????#??? 6,7
#?????.?###?##? 1,1,7
?.??#?#??# 2,4
?#???????# 1,2,3
????.????..##? 2,4,2
???????#?#? 1,6
???#.??#??.? 1,4
??###?###??..?????? 11,2,1
?????.?.??.#?.? 1,1,1,1,1
?#?????#.?#??. 2,5,4
??.????#?????#???#. 1,1,2,7
??###????????.? 4,2,1
?????.?.???.? 1,1,3,1
.?#??????#??.??##?#. 4,2,3,6
?##???#???#?? 2,3,3
????#????##??????? 1,13,1
???.??????##.... 2,3
.#??#???.???.?#?? 1,4,3,3
#??#?????#?#???##?? 2,10,3
?????##.??#?#??. 7,1,5
???#????#??? 5,2
????#???.?#??#???? 1,1,1,9
#???##???. 2,4
.#???..#????#??? 2,2,5
?????????#?? 7,1,1
?#??#????.???? 7,1,1,1
??.?#???#????????? 2,3,6,1
.?..??#?###. 1,7
???#????.?#?????? 4,1,2,2,1
.????#.???. 4,2
.???????.? 4,1
.?????????.??#? 1,1,2,4
.??##?##?????.?# 2,2,1,1,2
??????.#.?#? 2,1,2
?#???.???.??#????. 4,3,1,1,2
??#.???.??? 2,3,2
.????#????#??????? 10,4
.#.??#..?. 1,1
????????..?#???# 2,2,2,4,1
##??????.???.?#.?? 3,1,1,3,1,1
###???.?#.?#?#????# 3,2,1,4,2,1
#?.###??#.??? 2,3,1,1
???.??#..??.??? 1,1,1,2,1
??#?..?.?..?##???. 3,4
?..???#?#?? 1,7
????#?#????##??????? 10,1
.?????????.??.??##?? 4,1,1,1,6
?#???..?????. 2,1,1,1
?#.??#????? 1,3,1
.???##?#???#?. 1,4,2
..?????##??????.? 8,1,1
?????#?..??. 3,1,1
????#??#?.?#??. 6,3
????.?.##?????###? 1,1,2,2,4
?????.?#???? 2,1
#???#?#??.#.?. 1,6,1,1
????#.?.#??#??#??## 1,1,11
??##?#???#?.?.????? 1,8,1,1,2
.##??#.?#?? 5,1,1
.?#???.??????..??? 5,1,3,2
.???.??????.##???? 3,1,5
???#?#??#??????.???? 13,1
??.?#??.?# 1,2,1
??#????????.??.?.#? 1,9,2,1,1
??#??#..??#.? 4,1,3,1
#?.#??#???#???.??? 1,9,1,2
??#?????????? 1,1,3,1
????..?.?#?.???? 1,1,1,3,4
?#??.?#???? 1,5
?##??.??#.??..????? 2,3,3
.??.?????? 1,1
?##?#?##????????.?? 3,1,4,3,1,1
.???#?#?#?????#?? 4,7,3
?#??#???..? 4,1,1
...?###????#?#??#??# 3,8,2
???#????.??????#???? 2,1,7
#???????##?####.?? 1,1,1,2,4,1
??#.????#?????. 1,1,6
#??????#?.#? 1,1,1,1
#??#????????.?? 1,1,3,1,1
?#?#??#??? 3,2
..????.?#?. 1,2
??????##????. 5,3
????????.??#??. 6,1
.#?##????.?#?#.??? 8,2,1,3
??#?.????#????? 3,5
????#???????? 1,8
??.??#???#?? 1,1,4
???...???..? 1,3
..??##??#?#.?##### 9,5
..?#?.???. 2,1
#?#???#.#???#???? 1,2,2,2,5
??#???.??.?? 4,1,1
..???.?????... 2,1
?..?#???#?..??#????? 7,7
?.?...???#. 1,4
?..?#???#????? 6,2
??#???????#?????#?.. 2,9
?#??#???###????#. 1,7,1,1
???#..?#????.?##??# 4,5,3,1
.??#..#??.?? 3,1
????.#?.??..??#? 4,2,1,4
#????????#. 1,5,1
????#??.#.??? 4,1,1
.#?#?#??????? 1,1,8
???#?????.# 4,1,1
?????#??#.???.?. 7,1
??????????? 3,1,1
##??#?#???????# 5,1,4,1
?#???##?.??#??#????? 3,3,1,9
#????#.????#.?? 3,1,1,1,1
.??#.?#.??#?? 1,1,2,3
?.??##?##????.??.#.? 1,7,1,1,1
##???????.? 2,2
??#??.?#????. 2,1,3
?....#?#??. 1,1
??##??.?.??#? 4,1,1,2
??..?.?????# 1,1,1,1
.??.?????? 1,1
????#??..?#?#??#. 4,7
?##????#.??# 3,3,3
?#?#????.##?#?? 5,1,2,1,1
.#?#???.##? 1,4,2
.??????..?#??? 1,3,3,1
?##??#??.????? 6,1,1
.???.??... 1,1
.##???###???#?#?? 14,1
#?#?????###?.?????. 3,5,3
???.?#?#??#?????.?? 1,1,7,1,2,1
???#?.??##?? 1,4
#?#.???#???. 3,4
???.?.???.#???#? 1,1,2,1,2
..#??????#???? 4,4
.#???????????#??.. 1,3,6,1
.????###???#? 1,1,5,1
?.??????#???...?? 2,5
?????#??????.??#???? 7,1,3,1
??#?#..#??.#??? 2,1,2,1,1
.?#?.?#??#? 1,5
#???##??????????? 1,10,1
????#?###?#?.??.?.# 3,8,1,1,1
??.##????##. 3,1,2
.??##.?.??? 2,2
?#?#???????????##??? 11,4
?.?????#?.????#?? 1,1,1,1,4
?#?##?????##??????? 2,12,1
?????????#????.??? 10,1
???.#???.? 2,4
?#????.?#.?#?..#?## 2,1,2,2,1,2
???.#?#?#.?????? 5,2
.##??#?#??#?? 7,3
#.????#?#?#????.?? 1,3,7,1
??##???#???#??.?#?? 10,3
????#?????#. 4,1
?????.???? 4,1
?##??????#?##.? 2,7
.?##?????#?#?? 6,1,1,1
???????.???##?? 1,2,5
.?.??#????#??#??###. 1,1,12
??#??#???#.????. 5,3,2
?##??#??.???#??? 8,6
?##??.???????? 5,1,2,1
?.???.?.????#???# 1,3,1,2,5
??#?#????#???#??#. 3,2,9
?#.??????.??????? 2,1,1,1,4
?????#?????. 2,1,2,1
???.??#?#..???# 2,1,1,1,1
?#????????. 2,1,1
???#??..??.??#??. 3,3
????????..?? 2,1,1,1
.??..??#...?#.???# 1,3,2,3
?????###??.?? 4,1
????#?????? 6,1,1
.???????#??## 3,6
.?.???#???????#? 1,10,1
?#.???#??#?#???? 1,4,8
.??????##??? 1,4
#??##.?????#???##??? 1,3,1,8,1
????#????#?###????# 3,1,7,2,1
??.????###?????? 1,1,7
?#?#?.???.##? 4,1,2
????.?..???#?#? 4,1,1,5
?#???.?#??. 1,2
#??#????????????. 1,7,1,1,1
.?#..#?.##?#.??? 2,1,4,2
??.???.??#????#??#? 1,1,1,6,1,2
?..#??#.##?.#. 4,3,1
???###??##????# 1,7,2,1
###?????###?#??#..?? 13,1,1
.#?????#??? 1,6
?#??#??.??.?.? 6,1,1,1
.#??.?#..?#??? 3,1,4
??#??.?##??? 1,1,4,1
.#????#?#.?#?#?##??? 8,7,1
?#??#?#.???????. 7,3
#?.??#??##??????. 2,6,2
.#??#?#??.? 1,5
.????#??????#??? 2,7,3
.???#?#????.? 1,4,1,1
?#..???.#? 1,2,2
.#??????###????? 6,7
?.????.???#?? 1,1,1,2
??..??????.##?##???. 2,6
.#?#..?#????.?? 3,5
.#?#?????????? 5,1,1,1
.?.???#?#??.? 1,3
???#.?#?..????#?###? 2,2,8
.?#???.?.???##?.?.? 2,1,5,1,1
???????..#?##? 2,1,1,2
.?#?????.??#. 3,1,1,1
???#????#??.?.#?? 1,8,1,1,1
?????.????#??#?#? 3,11
#..?.#????#??#?..? 1,9,1
#.?.?#??.??? 1,1,3,2
????.????.?##???? 1,1,2,3,1
..??.?..???.?.?? 1,1
.???.##??#??#???? 1,1,6,1,1
#.#?????????# 1,1,3,2
#??#?#???.?????.? 1,5,1,1,1
??.###???..? 5,1
?#?#??##??#??.??. 4,7
??#?????????? 5,3
?#???#???. 2,2
??#??#?#??#?? 6,1,1
?.???#.?#?# 1,3,3
???#??????#???#?. 1,10,1
?.?#?##?.?? 1,4,1
#??##??.????#??. 1,3,6
#.???????#? 1,2,2
?#?#??.?.?#?#.?#? 3,1,1,3,2
??#???.?#?????? 2,1,6
.??#???##???# 1,2,7
??#??#???#?#?.?.?. 1,1,8,1
##???.?..??#?? 2,1,1,2
?#..????.????????#?. 2,2,10
??##?..?##????###.?? 4,10
?#?..??.?? 1,1,1
??????#??..??????.#? 8,1,1,1,1
???????.#?????..??.? 2,1,5,2,1
#?#????????##??? 4,1,1,6
.???#?..?????? 1,2,1,4
.#..???.??##??. 1,3,3,1
????#??????#???????? 1,1,5,2,1,1
?.?###?#?#?#?#?#?.?? 14,1
?.?.?#??????? 1,3,2,1
?##????????#?#??.# 5,1,3,1,1,1
???.???#????? 1,6
?????####?????#?#? 1,11,3
?#?.???#??? 1,2,1
..#??##??? 6,1
??????.??.. 2,3,1
.????#?.#???.?? 1,2,1,1,1
.??##?##??..??###??? 7,5
#???#??.??.?#.#.?. 1,2,2,1,1,1
??????#?#??.?? 5,1,2
#?#??#??????.????.?? 9,1,1,1,1
#?#..????#?????###? 1,1,1,4,7
.?.?????#.?# 1,1,2,1
?.???#?##?????#????? 5,2
#?????.??? 2,1,2
?????#??#?#????#?? 13,1
?.??#????#..?? 5,2,1
????#??##?.?.? 1,3,3,1
?.????.?##???#? 2,7
#?#?????#??.??##?? 6,1,1,1,2
???#?#??????#???.?.? 4,4,1,1,1
???#???#?#?.#? 4,5,1
??.?#???????????. 1,5,4
.?#.?????#.? 2,2,1,1
????.?#?###???#?.#.? 2,11,1
??#??????##?#?? 2,9
???????#?#?##??????? 3,1,7,1,1
???##?....??????? 6,6
?#.?#?.##?#?#. 1,1,2,3
??????????#? 4,2
#.?###?#???#?##?#?.? 1,13,1,1
??#?#?.?.???.??##?? 6,3,4
???.#?????##?.# 1,1,8,1
??????#?#?? 8,1
?#??????#??#?. 6,1,1
.#?#??#.#?#?#?.? 6,5,1
?????????#??.??#?#? 7,2,3
.????#??#????.??#? 8,1,3
??.?#???##?#??##??? 2,12,1
?#???###?.???.?? 7,3,2
#????.#???.???#..# 1,1,1,1,4,1
????##?.#? 6,2
??????####?.# 7,1
????#??.#. 1,4,1
.????#?????????##?? 15,1
???.????#?# 1,4
???????###. 1,5
#?.?????#??#?? 2,6
?????##????.#??#.?? 8,2,1
??####????##???.# 13,1
?..??#??#.?#?????? 1,3,1,1,1,1
.#???#???????#??#?? 6,1,8
??#?#..???? 4,2
.?#?.?.???? 2,1
.???????????? 2,1
????????#?.??? 1,1
??#???#???. 2,4,1
#??.????#.?. 3,3,1,1
?????#.?.?.????. 5,2
???#???.???? 1,5,1,1
#.?.?????#????? 1,6,1,1
?#?..#?#.??.??#?. 2,3,3
#????..???. 5,1,1
?#??#?????#???#. 1,3,1,1,3
???#?????????????.?? 4,2,1,5,2
????...?..??.????? 2,1
??.?..?####?#?#????# 1,14
???###?##??#?# 9,1,1
??.#??.???##? 1,3,5
??#??#???????? 1,2,1,2
?.###??##??.?#.. 9,1
?????#???? 1,1
#??????#?#???.?##?. 1,8,3
.?.??###?# 1,7
?????????##???.???# 1,2,1,4,2
?.?#???#???#.???? 2,1,2,2,1
#????#??????.?? 4,3,1,1,1
??????????.? 3,3,1
?????.??#?## 2,4
?###?#??.????..? 8,2,1
?????.##???.?? 3,4,1
#??????.??# 1,3,2
?#?????????#?.?? 7,3
????#??#?.??????. 5,1,5
.?#?#??#?.???### 8,1,3
??.?#???.???????.? 2,4,1,5,1
??.??#????.#?#???? 1,1,2,1,1,3
????????.???# 1,1,1,2
???#??#?#??.????#. 5,2,5
??.??.?#?.#?#? 2,2,1,4
.#????.#???????.?? 1,1,1,5
???###??????????.?? 15,1
???????##.??.??# 6,2,1,1,1
???????.??? 6,2
????????.?#?#.??#??. 3,3,3,4
????#?..?.. 3,1
?#??#?###???##?#?? 2,13
????###??? 2,4,1
??.?#??####?.??##??? 9,6
?#???..???.????? 4,2,1,2
??#??##???? 3,2
?#??#?##?????# 1,2,6,1
..????..???? 4,1,2
?#????.???..#???? 2,2,2,2,2
?#????????#??#??? 1,13
#???..#???????# 1,1,1,7
#?#.#????.?? 3,1,1,1
?.???????..?.?? 1,4
?.#??.????? 1,1,1
??#?.?????#. 3,3,2
.?.#??##?##???#? 1,12
??#????#??.#? 8,1
??#???..####?#??#? 5,7,2
???.#?#?????#?????? 1,6,2,2
??.???????#??##?#.. 1,2,4,4
#.??????????#???? 1,1,11
???#?#???#???. 1,4,2,2
?????.????? 1,1,4
??????#??##??. 9,1
??#???#?.??? 6,1
????.???##?.??.#??? 2,5,1,2,1
??.#?.?..?#????.?? 1,3
?#?#.??#.? 3,1
##??#?.#?????#?????? 3,1,3,1,1,4
????.?#???#??#?? 1,1,5,2,1
?????..?????? 4,5
??#..?#.?.????????#? 1,2,6,1
?#??#?##???#???#???. 2,8,1,1
????#????#.????.#? 1,5,1,1,1,1
?????????# 1,1,2
??#???##??. 3,4
?#?????#???#?? 1,1,6
??#??.#?#???#?????? 2,1,5,3
??????????#???#. 2,6,1
?????#?#??????#????? 11,1,1,1
?????#.?.?...??.?# 1,3,1,1,1,1
??#.#???#???????? 1,1,10,1
???#?.????.??#??# 1,3,1,1,6
#??????#.??#?.? 2,1,1,1,2
?.???????.??? 5,1
???#...?#?? 1,1,2
????.?????????.? 1,8
?##?#?##?#???###??? 3,14
??????#???#?#?#???#? 1,16
?.?????????????? 1,2,1,4,1
?..?.?#??##?..?????? 1,1,6,2,1
.?###?#?.??# 7,2
???#.#????.???? 1,2,3,1,3
?#.????#????? 2,1,5,1
#.##?????.#..??#???? 1,2,2,1,5
??#?##????.#???.?.?? 3,2,1,4,1,1
?.??#.?????#?#.. 3,6
????##??#??? 1,1,7
??.#?##??.? 1,6,1
??.???#?.??##????? 1,1,6,1
?#??.????###??.? 2,9
?????#??#???#.??. 1,7,1,1
?????????#? 2,3,1
#?????????.???? 8,4
??.#?.#?.?? 2,1,1
.????##?????#?#? 6,4
#??????.?#????? 1,2,6
?#???????. 3,4
???.???##???.??#? 1,8,2
.#???#??#????#??? 1,13
?.?????#????? 1,2,1,4
??.??????? 1,3
.????#??#?????# 8,1,1
.??#???#????????? 3,4,3
#?????#???#?#?.????? 7,4,1,1
???#.?.#??.??????? 4,1,1,1,4
???????#?? 3,3
??#???#???? 3,6
?????#????.?? 5,1,1
.???#?#..##.? 2,3,2,1
?#?.?????#?#?? 2,1,5
#.????.?????? 1,4,2,1
???#???..?#??#???. 6,6
#???.#?#?????#?? 4,10
#????????? 2,1,3
?#??#?#.?#?#???# 1,1,1,4,2
???????##?#?? 2,7
..??#?????.?#??? 5,3
..????????.???.? 1,1,2,1
?.??#????#?? 4,1
???.??.????.??. 1,2
.?????????###.?#?? 5,1,3,1
???.?#????#????? 1,8,1
??.??.???.??? 2,1,3,1
?.??###???????.. 4,3
????????????.#??? 3,3,1,2
???#?.#?###??#??? 1,3,5,1,2
?#??#???..??#?.. 7,4
#.??##?????. 1,1,4,1
?.??.#????#?#??#? 1,1,12
????#??#?.? 7,1
????#??.?? 2,3
?..??#?.????# 3,1,2
?.#?#???#???.#? 1,5,3,1
##??#?#???###?? 2,11
???#####??????? 2,10
??#?#?#?.?. 6,1
????..????..#?#. 1,1,3,1,1
.#?????#???##?#??? 14,1
#.??.?.??#.?.?? 1,2,3,1,1
?#??????.????.???.? 3,1,1,2,3,1
?.?.???#?? 1,1,2
??#?##????? 4,1
?.?#??.??. 2,1
??.???#.?? 1,1
##.?.?#?????.#? 2,5,1
?##?#.???????. 5,1,4
..?##???#.???? 6,2
.???.??????#?#?. 1,7
?????#.??#? 2,1,2
.#?.#?????????? 1,1,1,5,1
???.?????##??..? 2,1,1,4,1
?????##..? 5,1
#?????????#???? 1,3,1,3,1
?#????..???????##? 1,1,10
???#????#.??.????#? 1,2,1,1,2,6
??##.?.???.??..#? 3,3,1,2
?.?#?#?.???#?#??? 4,4
?##???.??#?.? 2,1,1
#?.??##??.?.#?????? 1,6,1,1,1
???#??#???.?##?? 7,3
?##??.?.?#????????#? 3,2,1,1
?..?#?.##?#?.? 2,5
?..??????? 1,2,2
??#?????.#???#??. 4,7
????.?????.. 2,4
.??#?.??.??..??????# 3,1,1,4,1
#???#?###??##?.? 1,11
??#??.???????#??#? 5,10
?.??#?..##?. 1,3,3
??.???.?.? 2,2
#??????##?##.?? 4,6,1
???????.?#????.?? 2,1,2,3,1
.??#???#???#?##.#.?? 13,1
??.??#?#?? 1,5,1
?#?#?#.?????.?? 2,3,2,2,1
????.???#????#? 1,1,2,4
.?????.????#. 2,1,1,1
.???.????.?? 1,1,1,1
?.????.?#.??#. 4,2,2
??????.?.???#?? 1,1,5
????????.?#???#?? 5,5
????####??##?? 7,5
.??##??????.???.? 10,1
#??#???#??#??? 1,3,4,1
.#???.????? 2,3
..??#??#??#??#?? 2,8
??????##??.???? 2,1,4,1
??????##??????????? 1,5,5,1,1
??#?.??????.?????? 3,1,1,1,1,2
???#.?#??? 2,2
##.??????#????# 2,2,8
?#????????? 5,3
?#?..????.?# 2,1,2
#??.?.#???#????# 1,1,1,3,1
?..??.??????? 1,1,1,2
?#?.?######?#???? 2,7,1,1
??##???.?###? 5,3
??#.??##..???????? 2,4,4
??????.#.??##?. 2,1,5
????#?.??? 1,2,1
.???????.?.? 2,2,1
?????#???????? 2,3,2,1
?.??.#?#?# 1,5
??.???.?????.?? 1,2,1,1,1
???.?..??? 1,1,2
????.?.??.? 1,2
?.????#??? 2,3
?????#???????.?? 7,2,1,1
???????.?## 1,4,3
?.?#?????? 4,1
??????#????#..?????? 11,3,1
#?##????##???##.? 4,1,7,1
?#???##??????##?#? 2,3,1,4,1
??..#?????#??.?? 1,9
?###.????.???#???? 3,2,1,6
???#????.????##??. 3,1,4
????#???.?##?. 1,1,2
.???#??##?#?# 1,6
#??.?????.?.? 3,4
?.??#?#?#????? 8,1
?????.????? 1,1,2
?.#???#????????#.#? 1,8,4,2
???#???#??#??????#.? 6,1,2,2,2
????.???.??????#? 2,1,7
??#.?????.?. 1,2,1,1
?#?##???.?#???????# 1,5,1,2,1,1
??????#?#.??? 3,3
??##??????..#??. 7,2
????.?.??.? 1,1
?????#??#? 2,1,2
???#?.???????# 4,1,3
??##????#?#?? 5,1,1,1
??##?.#?.#????????. 1,2,1,1,1,4
?.??.???.#. 2,1,1
???#??#?????###???.. 9,6
???????.???#.?# 1,2,3,2
???#?.####??????. 1,3,6,1,1
#?#??#?????###?#. 1,8,3,1
???#?????? 1,3,2
#?#??????#??#?.?? 13,2
.?????#.??#? 1,1,1,2
.###..?.???#??.?? 3,1,6,1
#??#???#?..?????###? 1,6,3,3
.??????#???. 1,3,1,2
#????#??.??????#?? 1,1,1,1,1,5
?????.??#??#???#?? 4,11
????#???#??????? 6,1
.??##?.?..?.#??#. 4,1,1,1,1
???#?????#??? 2,5
#?????.?????.?#? 3,1,5,3
??.#??#?#.? 2,1,1
?#.?????????.?. 1,7,1
###???#?????#????#.. 13,1,1
..???????.?.#.?? 1,4,1,1,1
??.#?#????????? 3,1
.????????.??#?#??? 5,7
?#.????????#???.? 1,2,1,4,1
?#.??##????#??#####? 1,6,8
???.?#?#???#?#. 2,5,3
##..?#????.# 2,6,1
#??#.#???##.. 1,1,1,4
.?.?##?????.?? 3,1
.#..#.??#??#?##?##.. 1,1,11
.?.?????##???#?. 1,7,3
?#???#????#???# 2,3,2,1
?##?#????.?# 7,1
?..??#?????? 1,1,1,4
..#?.?#?.???#???#? 1,2,4,3
????????.????? 3,2,4
???.???#?.?...# 1,1,2,1
#??###???#??? 6,2
?.?.?.?.#.?? 1,1,1,1
.?##?#??.??#???##?. 5,7
??.?????#?????? 2,9,1
.?#..?##??..#??# 2,4,4
????.??????#?????? 1,9,2
.????.##???? 1,2,4
.???.??.#?? 2,1,2
..???#???? 1,3
.??#???..?? 2,2,1
?#?#?????????.???? 13,2
???.??#??... 2,3
???.?#????#??. 1,6
?.??##??##????? 8,1
?.??#?###??#.?#?? 9,1
??###.?????#????##? 1,3,8,2
?????#??#.#.???###? 1,5,1,7
?...?#????. 2,2
????.??#?.???? 2,3,2
??.?????#.. 2,3
#??#??????.. 2,2,2,1`;
const test = `???.### 1,1,3
.??..??...?##. 1,1,3
?#?#?#?#?#?#?#? 1,3,1,6
????.#...#... 4,1,1
????.######..#####. 1,6,5
?###???????? 3,2,1`;

function format(input: string): Array<[string, number[]]> {
  return input.split("\n").map((l) => {
    const [line, numbers] = l.split(" ");
    const nums = numbers.split(",").map(Number);

    return [line, nums];
  });
}

function part1(input: string) {
  console.time("part1");
  let result = 0;

  const data = format(input);

  function check(
    positions: number[],
    ways: Set<string>,
    cur: string,
    nums: number[],
  ) {
    const trimmed = positions[positions.length - 1] === 0
      ? positions.splice(0, positions.length - 1)
      : positions;
    let valid = trimmed.length === nums.length;
    // check if valid
    trimmed.forEach((e, index) => {
      if (e !== nums[index]) {
        valid = false;
      }
    });

    // push to ways
    if (valid) {
      ways.add(cur);
    }
  }

  function branch(
    str: string,
    nums: number[],
    ways: Set<string>,
    cur: string,
    positions: number[],
    j: number,
  ) {
    if (cur.length === str.length) {
      check(positions, ways, cur, nums);
      return;
    }

    for (let i = j; i < str.length; i++) {
      if (str.charAt(i) == "?") {
        const fixedPos = [...positions];
        if (fixedPos[fixedPos.length - 1] !== 0) {
          let valid = true;
          fixedPos.forEach((e, i) => {
            if (e !== nums[i]) valid = false;
          });
          if (!valid) break;
          fixedPos.push(0);
        }
        branch(str, nums, ways, cur + ".", fixedPos, i + 1);

        const brokenPos = [...positions];
        brokenPos[brokenPos.length - 1]++;
        branch(
          str,
          nums,
          ways,
          cur + "#",
          brokenPos,
          i + 1,
        );
        break;
      } else if (str.charAt(i) === ".") {
        if (positions[positions.length - 1] !== 0) {
          let valid = true;
          positions.forEach((e, i) => {
            if (e !== nums[i]) valid = false;
          });
          if (!valid) break;
          positions.push(0);
        }
        cur += ".";
      } else {
        positions[positions.length - 1]++;
        cur += "#";
      }
    }

    if (cur.length === str.length) {
      check(positions, ways, cur, nums);
    }
  }

  for (const line of data) {
    const [str, nums] = line;
    const ways = new Set<string>();

    branch(str, nums, ways, "", [0], 0);

    result += ways.size;
  }

  console.log(result);
  console.timeEnd("part1");
}

function part2(input: string) {
  console.time("part2alt");
  let result = 0;

  const data = format(input);

  const numCache: { [key: string]: number } = {};

  data.forEach((line) => {
    const [str, nums] = line;
    const unfoldedStr = Array(5).fill(str).join("?");
    const unfoldedNums = Array(5).fill(nums).flat();
    let lineTotal = 0;

    function branch(
      variant: string,
      chunks: number[],
    ): number {
      const key = variant + "-" + chunks.join(",");
      const cachedNum = numCache[key];
      if (cachedNum || cachedNum >= 0) {
        return cachedNum;
      }

      const chunk = chunks[0];
      let variantTotal = 0;
      const reg = new RegExp(`(?=(\\?|#){${chunk}})`, "g");
      // find first start of this chunk
      const firstBroken = variant.indexOf("#") === -1
        ? variant.length
        : variant.indexOf("#");
      const search = variant.slice(0, firstBroken + chunk);
      const starts = [
        ...search.matchAll(reg) ?? [],
      ].map((e) => e.index ?? -1)
        .filter((e) => {
          let valid = true;
          valid = e <= firstBroken;
          valid = valid && e + chunk <= variant.length &&
            variant.charAt(e + chunk) !== "#";
          return valid;
        });

      for (const start of starts) {
        const newStr = variant.slice(start + chunk + 1);
        if (chunks.length > 1) {
          // continue with new variant, check on the next chunk
          const [_current, ...otherChunks] = chunks;
          variantTotal += branch(
            newStr,
            otherChunks,
          );
        } else if (newStr.includes("#")) {
          // last chunk covered, but still some # existing. Bad start
          continue;
        } else {
          // valid variant
          variantTotal++;
        }
      }

      numCache[key] = variantTotal;

      return variantTotal;
    }

    lineTotal = branch(unfoldedStr, unfoldedNums);
    result += lineTotal;
  });

  console.log("result", result);
  console.timeEnd("part2alt");
}

part1(test);
part1(real);
part2(test);
part2(real);
